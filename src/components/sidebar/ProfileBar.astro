---
import { SITE_MENU, USER_AVATAR, USER_SIDEBAR_SOCIAL_ICONS } from "../../config";
import { Icon } from "astro-icon/components";
import Card from "../temple/Card.astro";
import { Image } from "astro:assets";

// Get current path to determine active link
const currentPath = Astro.url.pathname;
---

<Card>
  <div class="relative p-4 flex flex-col">
    <div class="p-2 flex justify-center anna-profile-wrapper group cursor-help relative">
      <Image
        class="mask mask-circle transition-all duration-300 group-hover:brightness-105"
        format="webp"
        width={250}
        height={250}
        src={USER_AVATAR}
        alt="Profile"
        loading="eager"
      />
      
      <!-- ğŸ’§ æ…Œå¼ æ±—æ»´ (CSSç»˜åˆ¶) -->
      <div class="anna-sweat absolute top-12 right-6 opacity-0 pointer-events-none group-hover:opacity-100"></div>
      
      <!-- ğŸ’¢ æˆ–æ˜¯ éœ‡æƒŠçº¿ (CSSç»˜åˆ¶) -->
      <div class="anna-shock-lines absolute -top-2 left-10 opacity-0 pointer-events-none group-hover:opacity-100">
        <div class="line"></div>
        <div class="line"></div>
        <div class="line"></div>
      </div>

      <!-- ğŸŒ€ è´¥çŠ¬å‡è§†æ³¢çº¹ -->
      <div class="anna-ripple absolute inset-0 rounded-full pointer-events-none"></div>
    </div>
    <ul class="menu bg-transparent w-full m-0 p-0 hidden md:flex flex-col items-center lg:items-start">
      {
        SITE_MENU.map((item) => (
          <li class="w-full relative group">
            {item.subItems ? (
              <details class="menu-item w-full" data-submenu-id={item.id} open={currentPath.startsWith(item.href)}>
                <summary class="justify-center lg:justify-start items-center text-center text-xl md:text-3xl lg:text-xl font-bold p-4 hover:bg-base-200 rounded-lg">
                  <Icon name={item.svg} />
                  <span class="hidden lg:inline ml-2">{item.text}</span>
                </summary>
                <ul class="rounded-lg">
                  {item.subItems.map((subItem) => (
                    <li class="relative">
                      <a
                        tabindex="0"
                        class="menu-item text-base md:text-2xl lg:text-base font-bold p-2 hover:bg-base-200 rounded-lg"
                        id={`header-${subItem.id}`}
                        href={subItem.href}
                        target={subItem.target || "_self"}
                        aria-label={subItem.text}
                      >
                        <Icon name={subItem.svg} />
                        <span class="hidden lg:inline ml-2">{subItem.text}</span>
                      </a>
                    </li>
                  ))}
                </ul>
              </details>
            ) : (
              <a
                tabindex="0"
                class="flex justify-center lg:justify-start items-center text-center text-xl md:text-3xl lg:text-xl font-bold p-4 hover:bg-base-200 rounded-lg"
                id={item.id}
                href={item.href}
                target={item.target || "_self"}
                aria-label={item.text}
              >
                <Icon name={item.svg} />
                <span class="hidden lg:inline ml-2">{item.text}</span>
              </a>
            )}
          </li>
        ))
      }
    </ul>

    <!-- Social Icons -->
    <div class="mt-4 pt-3 border-t border-base-content/20">
      <div class="grid grid-cols-4 md:grid-cols-2 lg:grid-cols-4 gap-2 justify-items-center">
        {
          USER_SIDEBAR_SOCIAL_ICONS.map((icon) => (
            <div class="tooltip tooltip-bottom" data-tip={icon.title}>
              <a
                tabindex="0"
                href={icon.href}
                aria-label={icon.ariaLabel}
                target="_blank"
                class="btn btn-circle btn-ghost"
              >
                <Icon name={icon.svg} class="text-xl" />
              </a>
            </div>
          ))
        }
      </div>
    </div>
  </div>
</Card>

<style>
  /* 
    ğŸ’™ å…«å¥ˆè§æèœ - ä¾§è¾¹æ å¤´åƒç‰¹æ•ˆ 
    ä¸»é¢˜ï¼šè¢«æŠ“åŒ…çš„è´ªåƒé¬¼ / è´¥çŠ¬çš„å‡è§†
  */

  /* éœ‡åŠ¨åŠ¨ç”»ï¼šæ¨¡æ‹Ÿå·åƒè¢«å‘ç°æ—¶çš„â€œæ¿€çµâ€ */
  .group:hover .mask-circle {
    animation: anna-shock-shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
  }

  @keyframes anna-shock-shake {
    10%, 90% { transform: translate3d(-1px, 0, 0) rotate(-1deg); }
    20%, 80% { transform: translate3d(2px, 0, 0) rotate(2deg); }
    30%, 50%, 70% { transform: translate3d(-3px, 0, 0) rotate(-2deg); }
    40%, 60% { transform: translate3d(3px, 0, 0) rotate(1deg); }
  }

  /* ğŸ’§ æ±—æ»´ï¼šç»å…¸çš„è“è‰²ä¾§è¾¹å¤§æ±—æ»´ */
  .anna-sweat {
    width: 24px;
    height: 36px;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.9) 10%, #60a5fa 30%, #3b82f6 100%);
    border-radius: 0 50% 50% 50%;
    transform: rotate(45deg);
    filter: drop-shadow(0 2px 4px rgba(59, 130, 246, 0.3));
    transition: opacity 0.2s ease;
  }

  .group:hover .anna-sweat {
    animation: sweat-slide 1.8s infinite ease-in-out 0.1s;
  }

  @keyframes sweat-slide {
    0% {
      opacity: 0;
      transform: rotate(45deg) translate(-5px, -10px) scale(0.8);
    }
    20% {
      opacity: 1;
      transform: rotate(45deg) translate(0, 0) scale(1);
    }
    80% {
      opacity: 0.8;
      transform: rotate(45deg) translate(0, 15px) scale(0.95);
    }
    100% {
      opacity: 0;
      transform: rotate(45deg) translate(0, 20px) scale(0.9);
    }
  }

  /* ğŸ’¢/||| éœ‡æƒŠçº¿ï¼šå¤´é¡¶å†’å‡ºçš„ä¸‰æ¡é»‘çº¿/è“çº¿ */
  .anna-shock-lines {
    display: flex;
    gap: 8px;
    transform: rotate(-15deg);
  }

  .line {
    width: 6px;
    background: #1e40af; /* æ·±è´¥çŠ¬è“ */
    border-radius: 4px;
    opacity: 0.8;
    height: 0; /* åˆå§‹é«˜åº¦ä¸º0 */
    box-shadow: 0 0 5px rgba(30, 64, 175, 0.2);
  }

  .group:hover .anna-shock-lines .line {
    animation: lines-grow 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  }

  .group:hover .anna-shock-lines .line:nth-child(1) { height: 30px; animation-delay: 0s; }
  .group:hover .anna-shock-lines .line:nth-child(2) { height: 45px; animation-delay: 0.1s; }
  .group:hover .anna-shock-lines .line:nth-child(3) { height: 35px; animation-delay: 0.2s; }

  @keyframes lines-grow {
    from { height: 0; opacity: 0; }
    to { opacity: 0.9; } 
    /* height is controlled by forwards state */
  }

  /* ğŸŒ€ è´¥çŠ¬æ³¢çº¹ï¼šèƒŒæ™¯ä¸­éšçº¦æ‰©æ•£çš„å¿§éƒè“åœˆ */
  .anna-ripple {
    z-index: -1;
  }
  
  .anna-ripple::before,
  .anna-ripple::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px solid rgba(96, 165, 250, 0.4);
    transform: translate(-50%, -50%) scale(0.8);
    opacity: 0;
  }

  .group:hover .anna-ripple::before {
    animation: ripple-expand 2s infinite linear;
  }
  
  .group:hover .anna-ripple::after {
    animation: ripple-expand 2s infinite linear 1s;
  }

  @keyframes ripple-expand {
    0% {
      transform: translate(-50%, -50%) scale(0.8);
      opacity: 0.6;
      border-width: 4px;
    }
    100% {
      transform: translate(-50%, -50%) scale(1.4);
      opacity: 0;
      border-width: 0px;
    }
  }
</style>
